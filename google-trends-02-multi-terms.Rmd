---
title: "Google Trends Exploration, part 2: multiple terms"
author: "JY"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message=FALSE,
                      warning=FALSE)
```



## Google Trends package



Continued exploration from google-trends-01.Rmd of the capabilities of the 
**gtrendsR** package created by Philippe Massicotte <br  />
[gtrendsR vignette](https://cran.r-project.org/web/packages/gtrendsR/gtrendsR.pdf)

Focus here is on using gtrendsR with **more than 5 search terms**:

* Google Trends online interface allows for up to 5 search terms at the same time.
* gtrendsR has this same limitation.
* a benefit of gtrendsR is that you can do multiple queries with up to 5 search terms each, and as long as you have one search term that is used from one query to another, you can align all the terms together.

The example will explain what I mean.

Libraries used:

```{r}
library(gtrendsR) ## package for accessing Google Trends
library(tidyverse)
library(lubridate)
library(scales)
library(plotly)
library(gridExtra)

## set default ggplot2 chart theme
theme_set(theme_light())
```

## Example: 5 search terms

The above example shows how easy way it is to work with individual terms. gtrendsR also allows for working with multiple terms. The same limit of 5 search terms as in the Google Trends interface applies. 

### Set query parameters

```{r}
srch_term <- c("cryptocurrency",
               "stock market",
               "real estate",
               "gold",
               "casino")
period <- "today 3-m"
ctry <- "" ## blank = world; based on world countries ISO code
prop <- c("web")
cat <- 0 ## 0 = all categories

## user-friendly versions of parameters for use in chart titles or other query descriptions
ctry_ <- ifelse(ctry=="","world",ctry)
prop_ <- paste0(prop, collapse=", ")
cat_ <- ifelse(cat==0,"all",cat)
```

### Get Results

```{r}
## use gtrendsR to call google trends API
gt_results <- gtrends(keyword=srch_term,
        geo=ctry,
        time=period,
        gprop=prop,
        category=cat)
```

* Trend data is in the 'interest_over_time' object that is returned

These are the keywords within the 'interest_over_time':

```{r}
unique(gt_results$interest_over_time$keyword)
```

### Interest over time for multiple keywords

Trends for the search terms for the selected search term, country, period, property, and category.

```{r}
chart_title <- paste0("Searches for: ",paste0(srch_term, collapse=", "))
sub_title <- paste0("Period: ", period, "; Geo: ",ctry_,"; Prop: ", prop_,"; Category: ", cat_)

gt_results$interest_over_time %>% ggplot(aes(x=date, y=hits, color=keyword))+geom_line()+
  labs(title=chart_title, subtitle=sub_title, x="", y="")

```

Example 2: 4 different terms + one of the previous

* all the other parameters have to be the same

```{r}
srch_term <- c("cryptocurrency",
               "",
               "",
               "",
               "")
period <- "today 3-m"
ctry <- "" ## blank = world; based on world countries ISO code
prop <- c("web")
cat <- 0 ## 0 = all categories

## user-friendly versions of parameters for use in chart titles or other query descriptions
ctry_ <- ifelse(ctry=="","world",ctry)
prop_ <- paste0(prop, collapse=", ")
cat_ <- ifelse(cat==0,"all",cat)
```

